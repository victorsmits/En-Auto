<mat-card>
  <form action="" [formGroup]="estiForm">
    <mat-horizontal-stepper [linear]=false
                            (selectionChange)="selectionChange($event)" #stepper>

      <mat-step label="Adresse" class="step_display">
        <mat-form-field>
          <input matInput type="text" formControlName="address"
                 placeholder="Quelle est votre adresse ?">
          <mat-error>Veuilliez entrer une addresse du type : numero rue</mat-error>
        </mat-form-field>
        <mat-form-field>
          <input type="text" matInput formControlName="postalCode"
                 placeholder="Quelle est votre code postal ?">
          <mat-error>Veuillez entrer un code postal valide</mat-error>
        </mat-form-field>

        <div>
          <button mat-flat-button type="submit" color="primary" matStepperNext
                  [disabled]="! (estiForm.get('address').valid &&
              estiForm.get('postalCode').valid)">Next
          </button>
        </div>

      </mat-step>

      <mat-step label="Toiture" [stepControl]="estiForm" class="step_display">
        <mat-form-field>
          <input matInput type="number" formControlName="houseArea"
                 placeholder="Quelle est la superficie (sol) de votre maison ?">
        </mat-form-field>

        <p>Quelle est votre type de toit</p>
        <mat-radio-group aria-label="Quelle est le type de tuiles de votre toit"
                         formControlName="roof_type">
          <mat-radio-button value="3"> Toit plat</mat-radio-button>
          <mat-radio-button value="2"> Toit en t√¥le ondul√©s</mat-radio-button>
          <mat-radio-button value="1"> Toit en tuiles</mat-radio-button>
        </mat-radio-group>

        <p>Avez vous des tuiles a remplacer?</p>
        <mat-radio-group aria-label="Avez vous des tuiles a remplacer?"
                         formControlName="has_tiles">
          <mat-radio-button value="yes"> oui</mat-radio-button>
          <mat-radio-button value="no"> non</mat-radio-button>
        </mat-radio-group>

        <mat-form-field *ngIf="estiForm.value['has_tiles'] === 'yes' ">
          <input matInput type="number" formControlName="tiles_nb"
                 placeholder="combien de tuile(s) a remplacer?">
        </mat-form-field>

        <div>
          <button mat-flat-button color="primary" matStepperPrevious>Back</button>
          <button type="submit" mat-flat-button color="primary" matStepperNext
                  [disabled]="!estiForm.get('houseArea').valid">
            Next
          </button>
        </div>


      </mat-step>

      <mat-step label="Goutti√®re" [stepControl]="estiForm" class="step_display">

        <p>Avez vous besoin de faire installer une gouti√®re?</p>

        <mat-radio-group
          aria-label="Avez vous besoin de faire installer une gouti√®re?"
          formControlName="has_gutter">

          <mat-radio-button value="yes"> oui</mat-radio-button>
          <mat-radio-button value="no"> non</mat-radio-button>
        </mat-radio-group>

        <mat-form-field *ngIf="estiForm.value['has_gutter'] === 'yes' ">
          <input matInput type="number" formControlName="m_gutter"
                 placeholder="Combien de m√®tres de gouti√®re avez vous besoin d'installer?">
        </mat-form-field>

        <div>
          <button mat-flat-button color="primary" matStepperPrevious>Back</button>
          <button type="submit" mat-flat-button color="primary" matStepperNext>
            Next
          </button>
        </div>

      </mat-step>

      <mat-step label="Premi√®re estimation" class="step_display">
        <p>Gr√¢ce √† votre toit vous pouvez r√©colt√© {{water_volume * 1000}} L/an.</p>
        <p>Cela correspond √† {{(water_volume * 1000) / 60}} douches/an üöø (une
          douche correspond a 60L/an en moyenne) </p>
        <p>Vous pourriez √©conomiser jusqu'√† {{(water_volume / 4) * water_cost |number:'1.2-2'}} ‚Ç¨/mois</p>

        <div>
          <button mat-flat-button color="primary" matStepperPrevious>Back</button>
          <button type="submit" mat-flat-button color="primary"
                  (click)="goFurther()"
                  *ngIf="!go_further" matStepperNext>Aller plus loin
          </button>
          <button mat-flat-button type="submit" color="primary" matStepperNext *ngIf="go_further">
            Continuer
          </button>
        </div>

      </mat-step>

      <div *ngIf="go_further">
        <mat-step label="Utilisation" class="step_display">
          <p>Quelle est l'usage que vous voudriez faire ?</p>

          <mat-radio-group aria-label="Quelle est l'usage que vous voudriez faire ?"
                           formControlName="use">
            <mat-radio-button value="garden"> Jardin seulement</mat-radio-button>
            <mat-radio-button value="house"> Usage domestique</mat-radio-button>
            <mat-radio-button value="both"> Les deux</mat-radio-button>
          </mat-radio-group>

          <mat-form-field *ngIf="estiForm.value['use'] === 'garden' ">
            <input matInput type="number" formControlName="garden_area"
                   placeholder="Quelle est la superfecie de votre jardin ?">
          </mat-form-field>

          <mat-form-field *ngIf="estiForm.value['use'] === 'house' ">
            <input matInput type="number" formControlName="nb_machin"
                   placeholder="Combien de machines possedez vous ?">
          </mat-form-field>

          <div *ngIf="estiForm.value['use'] === 'both'">
            <mat-form-field>
              <input matInput type="number" formControlName="garden_area"
                     placeholder="Quelle est la superfecie de votre jardin ?">
            </mat-form-field>

            <mat-form-field>
              <input matInput type="number" formControlName="nb_machin"
                     placeholder="Combien de machines possedez vous ?">
            </mat-form-field>
          </div>

          <div *ngIf="estiForm.value['use'] === 'both' || estiForm.value['use'] === 'house'">

            <p>Connaissez vous votre consommation d'eau annuelle ?</p>

            <mat-radio-group
              aria-label="Connaissez vous votre consommation d'eau annuelle ?"
              formControlName="know_consum">
              <mat-radio-button value="yes"> oui</mat-radio-button>
              <mat-radio-button value="no"> non</mat-radio-button>
            </mat-radio-group>

            <mat-form-field *ngIf="estiForm.value['know_consum'] === 'yes' ">
              <input matInput type="number" formControlName="consommation"
                     placeholder="Combien de m3 d'eau consommez vous annuellement ?">
            </mat-form-field>

            <mat-form-field *ngIf="estiForm.value['know_consum'] === 'no' ">
              <input matInput type="number" formControlName="people"
                     placeholder="Combien de personnes habitent √† l'ann√©e votre domicile ?">
            </mat-form-field>

          </div>

          <div>
            <button mat-flat-button color="primary" matStepperPrevious>Back</button>
            <button type="submit" mat-flat-button color="primary" matStepperNext>
              Next
            </button>
          </div>

        </mat-step>

        <mat-step label="Cuve" class="step_display">

          <!--distance cuve maison-->
          <p *ngIf="water_volume >= 1000">Quelle type d'installation de cuve souhaitez-vous?</p>
          <p *ngIf="water_volume < 1000">Cuve : non enterr√©</p>

          <mat-radio-group
            aria-label="Quelle type d'installation de cuve souhaitez-vous?"
            formControlName="tank_type" *ngIf="water_volume >= 1000">
            <mat-radio-button value="dig"> Ent√©rer</mat-radio-button>
            <mat-radio-button value="not-dig"> Non Ent√©rer</mat-radio-button>
          </mat-radio-group>

          <p *ngIf="water_volume <1000"> Pour un volume de r√©cup√©ration inf√©rieur √† 1000L nous d√©conseillons les cuves
            enterr√©s. </p>

          <mat-form-field *ngIf="water_volume >= 1000">
            <input matInput type="number" formControlName="tank_dist"
                   placeholder="Distance cuve maison?">
          </mat-form-field>

          <div>
            <button mat-flat-button color="primary" matStepperPrevious>Back</button>
            <button type="submit" mat-flat-button color="primary" matStepperNext
                    [disabled]="checkIfTank()"> Terminer
            </button>
          </div>

        </mat-step>

        <mat-step label="Devis Finale" class="step_display">
          <p> Sauvegard√© votre devis en cr√©ant un compte sur notre site!</p>
          <div>
            <button mat-flat-button (click)="save()"> Sauvegarder</button>
          </div>
        </mat-step>

      </div>
    </mat-horizontal-stepper>
  </form>
</mat-card>

<mat-card *ngIf="first_devis">
  <div>
    <p>Gr√¢ce √† votre toit vous pouvez r√©colt√© {{water_volume * 1000}} L/an.</p>
  </div>
</mat-card>
